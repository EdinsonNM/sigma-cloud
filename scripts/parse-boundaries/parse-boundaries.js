/* fix coords scraped from geonames or geoJson for insertion into postgis boundbox type */

/* geonames.org/servlet/geonames?&srv=780&geonameId=8351030&type=json */
var geoNameShapes = {
	"shapes":[
		{
			"geoJson":{
				"coordinates":[
					[
						[
							[-76.7533,-12.4289],[-76.75285,-12.43145],[-76.75731,-12.44421],[-76.75168,-12.46269],[-76.75763,-12.47672],[-76.76836,-12.48235],[-76.77289,-12.49502],[-76.7908,-12.50312],[-76.79094,-12.50625],[-76.78647,-12.5129],[-76.78416,-12.51993],[-76.78638,-12.51649],[-76.79798,-12.51051],[-76.79928,-12.50797],[-76.80369,-12.50896],[-76.80266,-12.50454],[-76.79893,-12.50173],[-76.79867,-12.4996],[-76.80565,-12.49559],[-76.80521,-12.49388],[-76.80085,-12.49538],[-76.79805,-12.48938],[-76.80298,-12.47989],[-76.80091,-12.47873],[-76.80119,-12.48042],[-76.79802,-12.48055],[-76.79698,-12.47889],[-76.7945,-12.47941],[-76.79093,-12.47763],[-76.79238,-12.47371],[-76.78908,-12.4695],[-76.79179,-12.46794],[-76.79016,-12.46588],[-76.79085,-12.46454],[-76.78733,-12.46229],[-76.78852,-12.46175],[-76.78838,-12.45609],[-76.78436,-12.45597],[-76.78308,-12.45349],[-76.78505,-12.44344],[-76.78159,-12.44503],[-76.78097,-12.44244],[-76.78016,-12.44352],[-76.77866,-12.44158],[-76.77693,-12.44212],[-76.77539,-12.43927],[-76.77577,-12.43326],[-76.77877,-12.42837],[-76.77912,-12.42238],[-76.7812,-12.41796],[-76.78007,-12.41706],[-76.78159,-12.4149],[-76.78157,-12.40968],[-76.77786,-12.41162],[-76.77569,-12.4045],[-76.77813,-12.39998],[-76.77961,-12.40076],[-76.78137,-12.39814],[-76.7834,-12.39813],[-76.78222,-12.3967],[-76.78094,-12.39797],[-76.78047,-12.3943],[-76.77815,-12.39513],[-76.7774,-12.39356],[-76.77885,-12.39155],[-76.78436,-12.39086],[-76.78186,-12.38873],[-76.78379,-12.38551],[-76.78955,-12.38571],[-76.78963,-12.37924],[-76.7998,-12.36823],[-76.79822,-12.36555],[-76.80025,-12.36461],[-76.79942,-12.36228],[-76.80583,-12.35733],[-76.81725,-12.35227],[-76.81616,-12.34344],[-76.81927,-12.33944],[-76.82323,-12.33855],[-76.82699,-12.34294],[-76.82504,-12.34002],[-76.82827,-12.33846],[-76.82827,-12.33631],[-76.83092,-12.33441],[-76.83073,-12.33133],[-76.83485,-12.32964],[-76.83454,-12.32661],[-76.83775,-12.32428],[-76.8357,-12.32015],[-76.83661,-12.31617],[-76.83991,-12.31286],[-76.84327,-12.31341],[-76.84456,-12.30939],[-76.85529,-12.30019],[-76.86194,-12.2959],[-76.89113,-12.28352],[-76.90785,-12.2688],[-76.94443,-12.24528],[-77.02113,-12.21123],[-77.03784,-12.20565],[-77.03406,-12.20051],[-77.03984,-12.1931],[-77.03846,-12.19004],[-77.03955,-12.18214],[-77.03385,-12.17821],[-77.03347,-12.17628],[-77.03527,-12.17129],[-77.0384,-12.16842],[-77.0351,-12.16652],[-77.03611,-12.1653],[-77.03212,-12.16586],[-77.03173,-12.16431],[-77.03091,-12.16582],[-77.02791,-12.16551],[-77.02768,-12.15922],[-77.02633,-12.15882],[-77.02668,-12.15572],[-77.02489,-12.15348],[-77.02608,-12.14455],[-77.02954,-12.14015],[-77.02841,-12.13933],[-77.02993,-12.13566],[-77.03534,-12.13091],[-77.03712,-12.13269],[-77.03554,-12.13044],[-77.03808,-12.12719],[-77.03935,-12.12754],[-77.03875,-12.12615],[-77.04647,-12.12199],[-77.04585,-12.11972],[-77.05027,-12.11668],[-77.05117,-12.1175],[-77.05019,-12.11598],[-77.05128,-12.11426],[-77.06146,-12.10769],[-77.06101,-12.10642],[-77.06456,-12.10488],[-77.0651,-12.10288],[-77.08787,-12.09021],[-77.11153,-12.07949],[-77.10486,-12.07199],[-77.10457,-12.06335],[-77.08726,-12.06151],[-77.08837,-12.05873],[-77.0876,-12.05187],[-77.07822,-12.05004],[-77.07689,-12.04745],[-77.08155,-12.04702],[-77.08263,-12.04504],[-77.08294,-12.03642],[-77.09284,-12.03829],[-77.09618,-12.0337],[-77.08727,-12.01576],[-77.08912,-12.01216],[-77.09174,-12.00949],[-77.09351,-12.00999],[-77.09527,-12.00484],[-77.09785,-12.00564],[-77.10032,-12.00391],[-77.10329,-11.9978],[-77.10439,-12.00024],[-77.10705,-11.99936],[-77.11017,-11.99416],[-77.11326,-11.997],[-77.11791,-11.99429],[-77.11829,-11.9915],[-77.11234,-11.98198],[-77.11138,-11.97548],[-77.1133,-11.9723],[-77.11771,-11.97051],[-77.11652,-11.96648],[-77.11755,-11.95697],[-77.12058,-11.95051],[-77.12746,-11.94241],[-77.12869,-11.93718],[-77.12401,-11.93983],[-77.12005,-11.94497],[-77.10104,-11.95022],[-77.09589,-11.95009],[-77.09837,-11.94],[-77.10312,-11.93508],[-77.10188,-11.92802],[-77.09682,-11.92435],[-77.0899,-11.90179],[-77.09267,-11.89181],[-77.09259,-11.88148],[-77.09425,-11.87524],[-77.10023,-11.86822],[-77.10056,-11.85851],[-77.10545,-11.85892],[-77.11385,-11.84872],[-77.11308,-11.84396],[-77.11587,-11.83907],[-77.11368,-11.83365],[-77.12605,-11.82079],[-77.14711,-11.81928],[-77.16424,-11.82733],[-77.17046,-11.82673],[-77.17192,-11.82459],[-77.17912,-11.82837],[-77.18537,-11.82659],[-77.18811,-11.82852],[-77.18582,-11.82406],[-77.18261,-11.82451],[-77.18257,-11.82285],[-77.17976,-11.82274],[-77.18325,-11.82016],[-77.18296,-11.81884],[-77.17671,-11.81578],[-77.17897,-11.80929],[-77.17762,-11.80768],[-77.18028,-11.80715],[-77.17798,-11.80212],[-77.17975,-11.79989],[-77.18232,-11.79953],[-77.18087,-11.79708],[-77.1819,-11.79385],[-77.19018,-11.7837],[-77.19815,-11.78348],[-77.19534,-11.78016],[-77.19593,-11.77578],[-77.1988,-11.77267],[-77.19687,-11.77127],[-77.19827,-11.76821],[-77.19395,-11.76695],[-77.1909,-11.76813],[-77.19087,-11.77013],[-77.1887,-11.77057],[-77.18695,-11.7739],[-77.18211,-11.77325],[-77.17985,-11.77583],[-77.17768,-11.77466],[-77.17151,-11.76499],[-77.17114,-11.75276],[-77.16739,-11.74244],[-77.17228,-11.73078],[-77.17835,-11.72359],[-77.18361,-11.71221],[-77.1992,-11.69355],[-77.19721,-11.69054],[-77.19469,-11.69215],[-77.19226,-11.69033],[-77.19156,-11.68511],[-77.19352,-11.67832],[-77.17735,-11.67138],[-77.17223,-11.66478],[-77.16329,-11.65978],[-77.15197,-11.65714],[-77.1397,-11.66271],[-77.13133,-11.65735],[-77.12439,-11.65934],[-77.12471,-11.65318],[-77.13086,-11.64786],[-77.13124,-11.63986],[-77.13663,-11.63755],[-77.13749,-11.63553],[-77.13597,-11.63202],[-77.1297,-11.62539],[-77.12,-11.63044],[-77.11253,-11.6296],[-77.10759,-11.62675],[-77.10634,-11.62015],[-77.08561,-11.60459],[-77.0844,-11.59529],[-77.0806,-11.59045],[-77.07781,-11.57701],[-77.06781,-11.57247],[-77.06565,-11.57309],[-77.06353,-11.57756],[-77.0547,-11.57573],[-77.04668,-11.57914],[-77.03698,-11.58884],[-77.02396,-11.59526],[-77.01797,-11.60327],[-77.01003,-11.60734],[-77.00625,-11.61114],[-77.00546,-11.6158],[-77.01275,-11.62039],[-77.01613,-11.63312],[-77.02063,-11.63627],[-77.03499,-11.6524],[-77.03127,-11.65771],[-77.02477,-11.68102],[-77.01559,-11.6802],[-77.00803,-11.685],[-76.99844,-11.68647],[-76.9898,-11.68439],[-76.97608,-11.68538],[-76.97504,-11.68956],[-76.97974,-11.69607],[-76.97536,-11.71067],[-76.98022,-11.72576],[-76.97883,-11.72676],[-76.97013,-11.72525],[-76.96198,-11.72955],[-76.95933,-11.73485],[-76.95507,-11.73663],[-76.95255,-11.74404],[-76.94559,-11.75043],[-76.93862,-11.75108],[-76.93322,-11.75541],[-76.92179,-11.75121],[-76.91501,-11.74424],[-76.91424,-11.73202],[-76.90623,-11.72966],[-76.89692,-11.72938],[-76.88798,-11.73482],[-76.87988,-11.73456],[-76.87631,-11.74257],[-76.86608,-11.74779],[-76.85317,-11.74868],[-76.83934,-11.74695],[-76.83302,-11.74455],[-76.81259,-11.75002],[-76.8067,-11.75287],[-76.80487,-11.75587],[-76.82554,-11.7773],[-76.83461,-11.77882],[-76.8433,-11.7857],[-76.85124,-11.79815],[-76.86154,-11.79887],[-76.87749,-11.7946],[-76.88445,-11.79558],[-76.89649,-11.79322],[-76.90576,-11.79536],[-76.90737,-11.79773],[-76.90754,-11.80334],[-76.90382,-11.82372],[-76.91641,-11.83136],[-76.93564,-11.83368],[-76.93421,-11.84466],[-76.94228,-11.86087],[-76.93677,-11.86918],[-76.92745,-11.87045],[-76.92032,-11.86659],[-76.91184,-11.86494],[-76.89609,-11.86413],[-76.89493,-11.86575],[-76.8975,-11.87039],[-76.89741,-11.88066],[-76.90306,-11.88522],[-76.91211,-11.88927],[-76.918,-11.90645],[-76.91656,-11.91285],[-76.91827,-11.91966],[-76.91505,-11.9236],[-76.91502,-11.92712],[-76.92753,-11.93411],[-76.93137,-11.94217],[-76.92349,-11.9473],[-76.91953,-11.95908],[-76.91655,-11.95984],[-76.91043,-11.95459],[-76.89375,-11.95622],[-76.8864,-11.95231],[-76.87838,-11.95094],[-76.86349,-11.94506],[-76.85032,-11.93516],[-76.8455,-11.93578],[-76.83533,-11.94394],[-76.82931,-11.94499],[-76.8259,-11.94103],[-76.82528,-11.93431],[-76.81816,-11.92774],[-76.81541,-11.92667],[-76.79801,-11.92936],[-76.79168,-11.92761],[-76.78494,-11.91922],[-76.75706,-11.9029],[-76.74959,-11.89531],[-76.74169,-11.895],[-76.73887,-11.89332],[-76.72668,-11.87454],[-76.72569,-11.87818],[-76.7178,-11.88759],[-76.7135,-11.8888],[-76.71091,-11.89215],[-76.70343,-11.89149],[-76.69414,-11.89656],[-76.69285,-11.90189],[-76.68227,-11.91107],[-76.68083,-11.91536],[-76.66944,-11.92119],[-76.66877,-11.92355],[-76.67172,-11.92894],[-76.67066,-11.93105],[-76.66242,-11.9366],[-76.64696,-11.95288],[-76.64833,-11.96737],[-76.65392,-11.97099],[-76.65636,-11.97519],[-76.66141,-11.97906],[-76.6694,-11.98091],[-76.67351,-11.98018],[-76.681,-11.98806],[-76.68428,-11.9894],[-76.69067,-11.98688],[-76.70001,-11.98587],[-76.7085,-11.99235],[-76.71766,-11.9931],[-76.72234,-11.99959],[-76.71054,-12.01529],[-76.70656,-12.03237],[-76.70377,-12.0306],[-76.70074,-12.03218],[-76.68898,-12.04442],[-76.67808,-12.05298],[-76.67436,-12.06315],[-76.67339,-12.07283],[-76.68409,-12.08588],[-76.69486,-12.08853],[-76.70519,-12.08626],[-76.7067,-12.0898],[-76.7166,-12.10008],[-76.70997,-12.11348],[-76.69813,-12.11491],[-76.69373,-12.11877],[-76.69051,-12.12472],[-76.6793,-12.13097],[-76.69156,-12.14136],[-76.68792,-12.15183],[-76.67928,-12.16405],[-76.67394,-12.1672],[-76.67174,-12.17237],[-76.66034,-12.17346],[-76.66203,-12.17796],[-76.65267,-12.19256],[-76.64771,-12.20971],[-76.64078,-12.21377],[-76.6375,-12.21922],[-76.62211,-12.22532],[-76.62096,-12.23817],[-76.62537,-12.24528],[-76.62509,-12.25175],[-76.63679,-12.27936],[-76.64551,-12.28418],[-76.65041,-12.28478],[-76.65417,-12.30506],[-76.65973,-12.30889],[-76.663,-12.30874],[-76.66986,-12.31967],[-76.67399,-12.31952],[-76.67842,-12.33349],[-76.6781,-12.33955],[-76.68133,-12.34521],[-76.68192,-12.35325],[-76.67828,-12.35479],[-76.67532,-12.35904],[-76.66799,-12.36023],[-76.67534,-12.37621],[-76.68341,-12.38211],[-76.69314,-12.38398],[-76.69979,-12.38297],[-76.71937,-12.39312],[-76.72185,-12.39624],[-76.73281,-12.39597],[-76.7411,-12.39836],[-76.75013,-12.39674],[-76.75548,-12.39821],[-76.75691,-12.40147],[-76.75653,-12.40995],[-76.7533,-12.4289]
						]
					]
				],
				"type":"MultiPolygon"
			},
			"level":0,"geoShapeId":0,"isMainland":false
		}
	]
};

/* geonames.org/getJSON?id=8351030&style=gui */
var geoNameData = {
	"timezone":{
		"gmtOffset":-5,"timeZoneId":"America/Lima","dstOffset":-5
	},
	"bbox":{
		"east":-77.01248636125084,"south":-12.157306604954664,"north":-12.13059735492978,"west":-77.02943748626673
	},
	"asciiName":"Barranco","countryId":"3932488","fcl":"A","srtm3":73,"hasShape":"true","adminId2":"8349601",
	"adminId3":"8351030","countryCode":"PE","adminId1":"3936452","lat":"-12.14403","fcode":"ADM3","continentCode":"SA",
	"adminCode2":"1501","adminCode3":"150104","adminCode1":"15","lng":"-77.02086","geonameId":8351030,"toponymName":"Barranco",
	"url":"http://www.geonames.org/8351030/barranco.html","population":0,"wikipediaURL":"en.wikipedia.org/wiki/Barranca_District%2C_Barranca",
	"adminName5":"","adminName4":"","adminName3":"Barranco",
	"alternateNames":[
		{"name":"http://en.wikipedia.org/wiki/Barranca_District,_Barranca","lang":"link"}
	],
	"adminName2":"Lima","name":"Barranco","fclName":"country, state, region,...","countryName":"Peru",
	"fcodeName":"third-order administrative division","adminName1":"Lima region"
};


/* http://www.zillow.com/howto/api/neighborhood-boundaries.htm >> http://www.mapshaper.org/ */
/* drag drop ZillowNeighborhoods-NY.prj, *.dbf, *.shp >> mapshaper >> Export >> geoJson */
var geoJson = [
	{
		"type":"Feature",
		"geometry":{
			"type":"Polygon",
			"coordinates":[
				[
					[-73.9025199724177,40.691880020213],[-73.9050454545455,40.6936999990672],[-73.9042636363636,40.6956909081581],[-73.9115909090909,40.6998181808853],[-73.9106727272727,40.7010454536126],[-73.9126545454545,40.7022181808853],[-73.9118,40.7034363627035],[-73.9219,40.709390908158],[-73.9208181818182,40.7104545445216],[-73.9222381719784,40.7128877778105],[-73.919611247077,40.7133446343151],[-73.9151568961571,40.7130019919366],[-73.9129708786742,40.7148535416216],[-73.9106659299801,40.7162074036457],[-73.9036783764791,40.7203116960102],[-73.8955727272727,40.7250727263397],[-73.8955697948555,40.725072455276],[-73.8955700184504,40.7250700363857],[-73.8959760024664,40.7229283892295],[-73.8953430658507,40.7202633929527],[-73.8885600306096,40.7117600232444],[-73.8859400291519,40.7116500237568],[-73.8847600141563,40.7115400242691],[-73.8816399808746,40.711939974592],[-73.8795100181179,40.711289970789],[-73.8783067198462,40.7075014498477],[-73.8848210894792,40.7066462137626],[-73.8907031169759,40.7049901089334],[-73.8946000093073,40.7013700306553],[-73.9001257823832,40.6955103364631],[-73.9025199724177,40.691880020213]
				]
			]
		},
		"properties":{
			"STATE":"NY","COUNTY":"Queens","CITY":"New York City-Queens","NAME":"Ridgewood","REGIONID":275173
		}
	}
];

/* flattens a multi-dimensional array without recursion */
function flattenArray(array, mutable) {
	var toString = Object.prototype.toString;
	var arrayTypeStr = '[object Array]';
	var result = [];
	var nodes = (mutable && array) || array.slice();
	var node;
	if (!array.length) { return result; }
	node = nodes.pop();
	do {
		if (toString.call(node) === arrayTypeStr) {
			nodes.push.apply(nodes, node);
		} else {
			result.push(node);
		}
	} while (nodes.length && (node = nodes.pop()) !== undefined);
	result.reverse(); // we reverse result to restore the original order
	return result;
}

// converts flattened coordinates array to polygon or multipolygon string
// POLYGON((75.15 29.53 1,77 29 1,77.6 29.5 1,75.15 29.53 1)) // 3d
// MULTIPOLYGON(((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,743238 2967416)))
function coordStr( array, Ed ) {
	let grp = Ed ? 3 : 2;
	coordArr = [];
	for ( let i=0; i<array.length; i+grp) {
		let a = [];
		switch (true) {
			Ed:
				a.push(array[i]);
				a.push(array[i+1])
				a.push(array[i+2]);
				break;
			!Ed:
				a.push(array[i]);
				a.push(array[i+1])
				break;
		}
		coordArr.push(a.join(" "));
	}
	return coordArr.join(",");
}

function geometryToPolygonString ( geometry, Ed ) {
	let prefix = "POLYGON((";
	let postfix = "))";
	switch ( geometry.type.toLower() ) {
		"polygon": break;
		"multipolygon":
			prefix = "MULTIPOLYGON(((";
			postfix += ")";
			break;
		default: throw new error ("geometry type not supported");
	}
	let coords = coordStr( flattenArray(geometry.coordinates), Ed );
	return prefix + coords + postfix;
}

function parseZillowData(data) {

}

function parseGeoNamesData(data) {
	let parsed = {};
	parsed.region = [data.countryName,data.adminName1,data.adminName2,data.adminName3,data.adminName4,data.adminName5];
}
/*
"asciiName":"Barranco","countryId":"3932488","fcl":"A","srtm3":73,"hasShape":"true","adminId2":"8349601",
"adminId3":"8351030","countryCode":"PE","adminId1":"3936452","lat":"-12.14403","fcode":"ADM3","continentCode":"SA",
"adminCode2":"1501","adminCode3":"150104","adminCode1":"15","lng":"-77.02086","geonameId":8351030,"toponymName":"Barranco",
"url":"http://www.geonames.org/8351030/barranco.html","population":0,"wikipediaURL":"en.wikipedia.org/wiki/Barranca_District%2C_Barranca",
"adminName5":"","adminName4":"","adminName3":"Barranco",
"alternateNames":[
	{"name":"http://en.wikipedia.org/wiki/Barranca_District,_Barranca","lang":"link"}
],
"adminName2":"Lima","name":"Barranco","fclName":"country, state, region,...","countryName":"Peru",
"fcodeName":"third-order administrative division","adminName1":"Lima region"
*/

function parseData(data) {
	let hp = data.hasOwnProperty;
	let zillow = hp("STATE") && hp("STATE") && hp("CITY") && hp("NAME") && hp("REGIONID");
	let geonam = hp("asciiName") && hp("geonameId")
	switch (true) {
		zillow: break;
		geonam: break;
		default throw new error ("cannot identify data type for parsing");
	}
}



//http://postgis.net/docs/Populate_Geometry_Columns.html

//CREATE TABLE public.myspatial_table(gid serial, geom geometry);
//INSERT INTO myspatial_table(geom) VALUES(ST_GeomFromText('LINESTRING(1 2, 3 4)',4326) );


/*
SELECT ST_GeomFromText('POLYGON((-71.1776585052917 42.3902909739571,-71.1776820268866 42.3903701743239,
-71.1776063012595 42.3903825660754,-71.1775826583081 42.3903033653531,-71.1776585052917 42.3902909739571))');
*/
